name: Conformance CI

on: [push, pull_request]

jobs:
  run-conformance:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout Functions Framework for Node.js
      uses: actions/checkout@v2
      with:
        path: functions-framework-nodejs

    - name: Checkout Functions Framework Conformance
      uses: actions/checkout@v2
      with:
        repository: GoogleCloudPlatform/functions-framework-conformance
        path: functions-framework-conformance

    - name: Run HTTP conformance tests
      uses: GoogleCloudPlatform/functions-framework-conformance/action@v0.1.0
      with:
        functionType: 'http'
        validateMapping: false
        source: 'test/conformance'
        target: 'writeHTTP'
        runtime: 'nodejs10'
        tag: 'nodejs10_20200805_20_RC00'

    - name: Run event conformance tests
      uses: GoogleCloudPlatform/functions-framework-conformance/action@v0.1.0
      with:
        functionType: 'legacyevent'
        validateMapping: false
        source: 'test/conformance'
        target: 'writeLegacyEvent'
        runtime: 'nodejs10'
        tag: 'nodejs10_20200805_20_RC00'

    - name: Run cloudevent conformance tests
      uses: GoogleCloudPlatform/functions-framework-conformance/action@v0.1.0
      with:
        functionType: 'cloudevent'
        validateMapping: false
        source: 'test/conformance'
        target: 'writeCloudEvent'
        runtime: 'nodejs10'
        tag: 'nodejs10_20200805_20_RC00'
